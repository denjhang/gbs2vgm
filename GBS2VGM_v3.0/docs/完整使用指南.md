# GBS2VGM v2.2 - å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘ç¨‹åº

```bash
cd /d/working/vscode-projects/modizer-libs/gbsplay
make
```

### 2. è½¬æ¢GBSåˆ°VGM

```bash
# æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨è„šæœ¬ (æ¨è)
./convert_dq12.sh

# æ–¹æ³•2: æ‰‹åŠ¨è½¬æ¢
./gbs2vgm_batch.exe "path/to/file.m3u" "output_dir"
```

### 3. æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹VGMæ–‡ä»¶
ls -lh DQ12_VGM_v2.2/

# æŸ¥çœ‹å¾ªç¯ç‚¹æŠ¥å‘Š
cat DQ12_VGM_v2.2/loop_report.txt

# æ’­æ”¾VGMæ–‡ä»¶
vgmplay "DQ12_VGM_v2.2/04 [DQ I] Ladutorm Castle.vgm"
```

---

## ğŸ“š è¯¦ç»†è¯´æ˜

### è½¬æ¢æµç¨‹

```
è¾“å…¥: M3Uæ’­æ”¾åˆ—è¡¨ + GBSæ–‡ä»¶
  â†“
æ­¥éª¤1: è§£æM3Uæ–‡ä»¶
  â”œâ”€ è¯»å–æ›²ç›®ä¿¡æ¯
  â”œâ”€ è¯†åˆ«å¾ªç¯æ›²ç›® (loop_count=10)
  â””â”€ è¯†åˆ«éå¾ªç¯æ›²ç›® (loop_count=1)
  â†“
æ­¥éª¤2: è½¬æ¢GBSåˆ°VGM
  â”œâ”€ å¾ªç¯æ›²ç›®: å½•åˆ¶ duration Ã— 3
  â””â”€ éå¾ªç¯æ›²ç›®: å½•åˆ¶ duration + 3ç§’fadeout
  â†“
æ­¥éª¤3: æ£€æµ‹å¾ªç¯ç‚¹ (vgmlpfnd)
  â”œâ”€ åˆ†æå‘½ä»¤åºåˆ—
  â”œâ”€ æŸ¥æ‰¾é‡å¤æ¨¡å¼
  â””â”€ è¾“å‡ºå¾ªç¯ç‚¹ä¿¡æ¯
  â†“
æ­¥éª¤4: [å¾…å®ç°] ä¿®å‰ªVGMæ–‡ä»¶
  â”œâ”€ æ ¹æ®å¾ªç¯ç‚¹ä¿®å‰ªæ•°æ®
  â”œâ”€ è®¾ç½®VGMå¤´éƒ¨å¾ªç¯åç§»
  â””â”€ å‡å°æ–‡ä»¶å¤§å°
  â†“
è¾“å‡º: VGMæ–‡ä»¶ + å¾ªç¯ç‚¹æŠ¥å‘Š
```

### M3Uæ ¼å¼è¯´æ˜

**æ—§æ ¼å¼** (5ä¸ªé€—å·):
```
filename.gbs::GBS,subsong,title,duration,,loop_count
```

**æ–°æ ¼å¼** (6ä¸ªé€—å·, GMEå…¼å®¹):
```
filename.gbs::GBS,subsong,title,duration,intro-loop,fade,loop_count
```

**loop_countå«ä¹‰**:
- `1` = éå¾ªç¯æ›²ç›® (ç‰‡å¤´æ›²ã€éŸ³æ•ˆ)
- `10` = å¾ªç¯æ›²ç›® (æˆ˜æ–—éŸ³ä¹ã€åŸé•‡éŸ³ä¹)

### å¾ªç¯ç‚¹æŠ¥å‘Šæ ¼å¼

```
## 04 [DQ I] Ladutorm Castle.vgm
1061612	00:24.07  !	6151996	02:19.50	147219	09:11.73
   â†‘          â†‘      â†‘      â†‘          â†‘        â†‘        â†‘
 æ ·æœ¬ä½ç½®   æ—¶é—´    æ ‡è®°  æ ·æœ¬ä½ç½®    æ—¶é—´    å‘½ä»¤æ•°   æ—¶é•¿
å¾ªç¯å¼€å§‹                 å¾ªç¯ç»“æŸ              å¾ªç¯é•¿åº¦
```

**æ ‡è®°è¯´æ˜**:
- `!` = æœ€ä½³å¾ªç¯ç‚¹ (æ¨èä½¿ç”¨)
- æ— æ ‡è®° = å…¶ä»–å¯èƒ½çš„å¾ªç¯ç‚¹

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰è½¬æ¢å‚æ•°

ç¼–è¾‘ `gbsplay/gbs2vgm_batch.c`:

```c
// é‡‡æ ·ç‡ (é»˜è®¤: 44100 Hz)
static long rate = 44100;

// æ·¡å‡ºæ—¶é•¿ (é»˜è®¤: 3ç§’)
static long fadeout = 3;

// é™éŸ³æ£€æµ‹è¶…æ—¶ (é»˜è®¤: 0 = ç¦ç”¨)
static long silence_timeout = 0;
```

### è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼ (åªè½¬æ¢ç¬¬ä¸€é¦–æ›²ç›®,ç”Ÿæˆè¯¦ç»†æ—¥å¿—)
./gbs2vgm_batch.exe -d "path/to/file.m3u" "output_dir"

# æŸ¥çœ‹è°ƒè¯•æ—¥å¿—
cat output_dir/*_debug.txt
```

### å•æ›²è½¬æ¢

åˆ›å»ºæµ‹è¯•M3Uæ–‡ä»¶:
```bash
cat > test.m3u << EOF
# @TITLE Test
# @COMPOSER Test

path/to/file.gbs::GBS,0,Test Track,2:00,,10
EOF

./gbs2vgm_batch.exe test.m3u test_output
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å¹¶è¡Œè½¬æ¢

å½“å‰ç‰ˆæœ¬æŒ‰é¡ºåºè½¬æ¢æ¯é¦–æ›²ç›®ã€‚æœªæ¥ç‰ˆæœ¬å¯ä»¥å®ç°å¹¶è¡Œè½¬æ¢:

```bash
# æœªæ¥ç‰ˆæœ¬ (v3.0)
./gbs2vgm_batch.exe -j 4 "file.m3u" "output"  # ä½¿ç”¨4ä¸ªçº¿ç¨‹
```

### å†…å­˜ä½¿ç”¨

- æ¯ä¸ªVGMæ–‡ä»¶åœ¨å†…å­˜ä¸­å®Œæ•´æ„å»º
- é•¿æ›²ç›®(>5åˆ†é’Ÿ)å¯èƒ½å ç”¨è¾ƒå¤šå†…å­˜
- å»ºè®®: è‡³å°‘2GBå¯ç”¨å†…å­˜

### ç£ç›˜ç©ºé—´

- å¾ªç¯æ›²ç›®: çº¦ duration Ã— 3 Ã— 3KB/ç§’
- éå¾ªç¯æ›²ç›®: çº¦ duration Ã— 3KB/ç§’
- ç¤ºä¾‹: 3åˆ†é’Ÿå¾ªç¯æ›²ç›® â‰ˆ 1.6MB

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: ç¼–è¯‘å¤±è´¥

**ç—‡çŠ¶**: `make: *** No rule to make target`

**è§£å†³**:
```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd /d/working/vscode-projects/modizer-libs/gbsplay

# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
make clean
make
```

### é—®é¢˜2: è½¬æ¢å¤±è´¥ - æ–‡ä»¶å¾ˆå°(< 1KB)

**ç—‡çŠ¶**: VGMæ–‡ä»¶åªæœ‰å‡ ç™¾å­—èŠ‚

**åŸå› **: æ•´æ•°æº¢å‡º (å·²åœ¨v2.2ä¿®å¤)

**è§£å†³**: ç¡®ä¿ä½¿ç”¨v2.2æˆ–æ›´é«˜ç‰ˆæœ¬

### é—®é¢˜3: æœªæ‰¾åˆ°å¾ªç¯ç‚¹

**ç—‡çŠ¶**: å¾ªç¯æ›²ç›®æ˜¾ç¤º"æ— å¾ªç¯ç‚¹"

**å¯èƒ½åŸå› **:
1. å¾ªç¯æ¨¡å¼å¤ªå¤æ‚
2. å½•åˆ¶é•¿åº¦ä¸è¶³
3. vgmlpfndæ£€æµ‹å‚æ•°ä¸åŒ¹é…

**è§£å†³**:
```bash
# æ‰‹åŠ¨è¿è¡Œvgmlpfnd,è°ƒæ•´å‚æ•°
echo "file.vgm" | ./gbsplay/vgmlpfnd.exe -silent
```

### é—®é¢˜4: Bankè­¦å‘Š

**ç—‡çŠ¶**: "Bank 112 out of range (0-8)!"

**å½±å“**: æ— ,å¯ä»¥å¿½ç•¥

**åŸå› **: GBSæ–‡ä»¶è®¿é—®è¶…å‡ºèŒƒå›´çš„ROM bank (æ­£å¸¸ç°è±¡)

---

## ğŸ“– æŠ€æœ¯å‚è€ƒ

### VGMæ–‡ä»¶æ ¼å¼

```
åç§»    å¤§å°    è¯´æ˜
0x00    4       æ ‡è¯† "Vgm "
0x04    4       EOFåç§»
0x08    4       ç‰ˆæœ¬å·
0x0C    4       SN76489æ—¶é’Ÿ
...
0x18    4       æ€»æ ·æœ¬æ•°
0x1C    4       å¾ªç¯åç§»
0x20    4       å¾ªç¯æ ·æœ¬æ•°
...
0x34    4       æ•°æ®åç§»
...
0xBC    4       Game Boy DMGæ—¶é’Ÿ (4194304 Hz)
```

### Game BoyéŸ³é¢‘å¯„å­˜å™¨

```
0xFF10-0xFF14: æ–¹æ³¢1 (æ‰«é¢‘)
0xFF16-0xFF19: æ–¹æ³¢2
0xFF1A-0xFF1E: æ³¢å½¢
0xFF20-0xFF23: å™ªå£°
0xFF24-0xFF26: æ§åˆ¶/çŠ¶æ€
0xFF30-0xFF3F: æ³¢å½¢RAM
```

### å¾ªç¯æ£€æµ‹ç®—æ³•

vgmlpfndä½¿ç”¨å‘½ä»¤åºåˆ—æ¯”è¾ƒ:

```
1. è¯»å–VGMå‘½ä»¤æµ
2. å¯¹æ¯ä¸ªä½ç½®i:
   a. ä»iå¼€å§‹,æŸ¥æ‰¾åç»­é‡å¤åºåˆ—
   b. è®¡ç®—åŒ¹é…é•¿åº¦
   c. å¦‚æœåŒ¹é…é•¿åº¦ > MIN_EQU_SIZE (1024å‘½ä»¤)
      â†’ è®°å½•ä¸ºæ½œåœ¨å¾ªç¯ç‚¹
3. é€‰æ‹©æœ€ä½³å¾ªç¯ç‚¹:
   - ä¼˜å…ˆé€‰æ‹©è¦†ç›–åˆ°æ–‡ä»¶æœ«å°¾çš„å¾ªç¯
   - ä¼˜å…ˆé€‰æ‹©è¾ƒé•¿çš„å¾ªç¯
```

---

## ğŸ”— ç›¸å…³èµ„æº

### æ–‡æ¡£
- `README_v2.2.md` - æŠ€æœ¯æ–‡æ¡£
- `ä½¿ç”¨è¯´æ˜_v2.2.md` - ä½¿ç”¨è¯´æ˜
- `DQ12_è½¬æ¢æŠ¥å‘Š.md` - è½¬æ¢æŠ¥å‘Š

### å·¥å…·
- `gbs2vgm_batch.exe` - ä¸»ç¨‹åº
- `vgmlpfnd.exe` - å¾ªç¯ç‚¹æ£€æµ‹
- `vgm_parser.exe` - VGMä¿¡æ¯æŸ¥çœ‹
- `test_m3u_parser.exe` - M3Uè§£ææµ‹è¯•

### è„šæœ¬
- `convert_dq12.sh` - DQ1&2è‡ªåŠ¨è½¬æ¢
- `auto_convert.sh` - é€šç”¨è‡ªåŠ¨è½¬æ¢
- `Makefile` - ç¼–è¯‘é…ç½®

### é¡¹ç›®é“¾æ¥
- gbsplay: https://github.com/mmitch/gbsplay
- vgmtools: https://github.com/vgmrips/vgmtools
- GME: https://bitbucket.org/mpyne/game-music-emu/

---

## ğŸ“ ç‰ˆæœ¬å†å²

### v2.2 (2026-02-04) - å½“å‰ç‰ˆæœ¬
- âœ… ä¿®å¤æ•´æ•°æº¢å‡ºbug
- âœ… æ”¯æŒM3Uæ—§æ ¼å¼
- âœ… ç¦ç”¨é™éŸ³æ£€æµ‹
- âœ… åˆ›å»ºMakefile
- âœ… é›†æˆvgmlpfnd
- âœ… æˆåŠŸè½¬æ¢DQ1&2

### v2.1
- ç§»é™¤é”™è¯¯çš„å¾ªç¯ç‚¹è®¾ç½®

### v2.0
- åˆå§‹ç‰ˆæœ¬

### v2.3 (è®¡åˆ’ä¸­)
- ğŸ”œ VGMè‡ªåŠ¨ä¿®å‰ª
- ğŸ”œ å¾ªç¯ç‚¹è‡ªåŠ¨è®¾ç½®
- ğŸ”œ æ–‡ä»¶å¤§å°ä¼˜åŒ–

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. è½¬æ¢å‰å‡†å¤‡

```bash
# æ£€æŸ¥M3Uæ–‡ä»¶æ ¼å¼
cat file.m3u | head -20

# æ£€æŸ¥GBSæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh *.gbs

# ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
df -h .
```

### 2. è½¬æ¢è¿‡ç¨‹

```bash
# ä½¿ç”¨è‡ªåŠ¨è„šæœ¬
./convert_dq12.sh

# æˆ–åˆ†æ­¥æ‰§è¡Œ
./gbs2vgm_batch.exe "file.m3u" "output"
cd output
for vgm in *.vgm; do
    echo "$vgm" | ../gbsplay/vgmlpfnd.exe -silent > "${vgm%.vgm}_loop.txt"
done
```

### 3. è½¬æ¢åéªŒè¯

```bash
# æ£€æŸ¥æ–‡ä»¶å¤§å°
ls -lh output/*.vgm

# æ£€æŸ¥VGMä¿¡æ¯
./vgm_parser.exe "output/track.vgm"

# æµ‹è¯•æ’­æ”¾
vgmplay "output/track.vgm"
```

### 4. å¾ªç¯ç‚¹åˆ†æ

```bash
# æŸ¥çœ‹æ‰€æœ‰æ‰¾åˆ°å¾ªç¯ç‚¹çš„æ›²ç›®
grep "!" output/loop_report.txt

# ç»Ÿè®¡å¾ªç¯ç‚¹æ£€æµ‹æˆåŠŸç‡
total=$(ls output/*.vgm | wc -l)
found=$(grep "!" output/loop_report.txt | wc -l)
echo "æ£€æµ‹æˆåŠŸç‡: $found/$total"
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### ç†è§£GBSæ ¼å¼
- GBSæ–‡ä»¶æ˜¯Game BoyéŸ³ä¹çš„å®¹å™¨æ ¼å¼
- åŒ…å«Z80æœºå™¨ç å’ŒéŸ³é¢‘æ•°æ®
- é€šè¿‡æ¨¡æ‹ŸGame Boyç¡¬ä»¶æ’­æ”¾

### ç†è§£VGMæ ¼å¼
- VGMæ˜¯é€šç”¨æ¸¸æˆéŸ³ä¹æ ¼å¼
- è®°å½•éŸ³é¢‘èŠ¯ç‰‡çš„å¯„å­˜å™¨å†™å…¥
- æ”¯æŒå¤šç§éŸ³é¢‘èŠ¯ç‰‡

### å¾ªç¯ç‚¹çš„é‡è¦æ€§
- æ¸¸æˆéŸ³ä¹é€šå¸¸è®¾è®¡ä¸ºæ— é™å¾ªç¯
- æ­£ç¡®çš„å¾ªç¯ç‚¹ç¡®ä¿æµç•…æ’­æ”¾
- é¿å…é‡å¤å¬åˆ°introéƒ¨åˆ†

---

**æœ€åæ›´æ–°**: 2026-02-04
**ä½œè€…**: Claude Sonnet 4.5 & Denjhang
**è®¸å¯**: GNU GPL v1 or later
